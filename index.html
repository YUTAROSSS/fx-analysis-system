<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>メインデータ復元</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>FX分析システム - メインデータ復元</h1>
    <button onclick="restoreMainData()" style="padding: 20px; font-size: 18px; background: green; color: white;">メインデータを復元</button>
    <div id="result" style="margin-top: 20px; font-size: 16px;"></div>

    <script>
        const supabase = window.supabase.createClient(
            'https://jfrwyunauatsybdljlah.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impmcnd5dW5hdWF0c3liZGxqbGFoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1MTMxODksImV4cCI6MjA2OTA4OTE4OX0.cyhPTiN4WAQ2p86JBZObjSljt2i1K_bK-cGGo3soxAo'
        );

        async function restoreMainData() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'メインデータを復元中...';

            try {
                // メインデータの構造
                const mainData = {
                    scenarios: {
                        "GOLD": ["scenario1"],
                        "AUDUSD": ["scenario1", "scenario2"],
                        "EURUSD": ["scenario1", "scenario2"],
                        "GBPUSD": ["scenario1", "scenario2", "scenario3", "scenario4"],
                        "SILVER": ["scenario1", "scenario2"],
                        "USDJPY": ["scenario1", "scenario2", "scenario3"]
                    },
                    currencies: ["USDJPY", "EURUSD", "GBPUSD", "AUDUSD", "SILVER", "GOLD"],
                    waveSettings: {},
                    scenarioMemos: {},
                    scenarioLabels: {
                        "scenario1": "シナリオ1",
                        "scenario2": "シナリオ2",
                        "scenario3": "シナリオ3",
                        "scenario4": "シナリオ4"
                    },
                    currentCurrency: "USDJPY",
                    currentScenario: "scenario1",
                    scenarioStatuses: {},
                    images: {
                        "USDJPY": {
                            "scenario1": ["https://jfrwyunauatsybdljlah.supabase.co/storage/v1/object/public/fx-images/USDJPY.jpeg"],
                            "scenario2": ["https://jfrwyunauatsybdljlah.supabase.co/storage/v1/object/public/fx-images/USDJPY2.jpeg"],
                            "scenario3": ["https://jfrwyunauatsybdljlah.supabase.co/storage/v1/object/public/fx-images/USDJPY3.jpeg"]
                        },
                        "EURUSD": {
                            "scenario1": ["https://jfrwyunauatsybdljlah.supabase.co/storage/v1/object/public/fx-images/EURUSD.jpeg"],
                            "scenario2": ["https://jfrwyunauatsybdljlah.supabase.co/storage/v1/object/public/fx-images/EURUSD2.jpeg"]
                        },
                        "GBPUSD": {
                            "scenario1": ["https://jfrwyunauatsybdljlah.supabase.co/storage/v1/object/public/fx-images/GBPUSD.jpeg"],
                            "scenario2": ["https://jfrwyunauatsybdljlah.supabase.co/storage/v1/object/public/fx-images/GBPUSD2.jpeg"],
                            "scenario3": ["https://jfrwyunauatsybdljlah.supabase.co/storage/v1/object/public/fx-images/GBPUSD3.jpeg"],
                            "scenario4": ["https://jfrwyunauatsybdljlah.supabase.co/storage/v1/object/public/fx-images/GBPUSD4.jpeg"]
                        },
                        "AUDUSD": {
                            "scenario1": ["https://jfrwyunauatsybdljlah.supabase.co/storage/v1/object/public/fx-images/AUDUSD.jpeg"],
                            "scenario2": ["https://jfrwyunauatsybdljlah.supabase.co/storage/v1/object/public/fx-images/AUDUSD2.jpeg"]
                        },
                        "SILVER": {
                            "scenario1": ["https://jfrwyunauatsybdljlah.supabase.co/storage/v1/object/public/fx-images/SILVER.jpeg"],
                            "scenario2": ["https://jfrwyunauatsybdljlah.supabase.co/storage/v1/object/public/fx-images/SILVER2.jpeg"]
                        },
                        "GOLD": {
                            "scenario1": ["https://jfrwyunauatsybdljlah.supabase.co/storage/v1/object/public/fx-images/GOLD.png"]
                        }
                    }
                };

                // メインデータを挿入
                const { error } = await supabase
                    .from('fx_analysis_data')
                    .upsert([{
                        id: 'main',
                        data: mainData,
                        images: {},
                        updated_at: new Date().toISOString()
                    }]);

                if (error) {
                    throw error;
                }

                resultDiv.innerHTML = '✅ 成功！メインデータが復元されました。';

                // 確認のため、復元されたデータを表示
                const { data: restoredData } = await supabase
                    .from('fx_analysis_data')
                    .select('*')
                    .eq('id', 'main')
                    .single();

                if (restoredData) {
                    resultDiv.innerHTML += '<br><br><strong>復元されたデータ:</strong><br><pre>' + JSON.stringify(restoredData, null, 2) + '</pre>';
                }

            } catch (error) {
                resultDiv.innerHTML = `❌ エラー: ${error.message}`;
                console.error('復元エラー:', error);
            }
        }
    </script>
</body>
</html>
